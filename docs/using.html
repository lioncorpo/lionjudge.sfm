

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Using &mdash; OpenSfM 0.4.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/javascript" src="_static/mathjax_conf.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Dataset Structure" href="dataset.html" />
    <link rel="prev" title="Building" href="building.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> OpenSfM
          

          
          </a>

          
            
            
              <div class="version">
                0.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="building.html">Building</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reconstruction-commands">Reconstruction Commands</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#extract-metadata">extract_metadata</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#providing-additional-metadata">Providing additional metadata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#providing-your-own-camera-parameters">Providing your own camera parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#detect-features">detect_features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#match-features">match_features</a></li>
<li class="toctree-l3"><a class="reference internal" href="#create-tracks">create_tracks</a></li>
<li class="toctree-l3"><a class="reference internal" href="#reconstruct">reconstruct</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mesh">mesh</a></li>
<li class="toctree-l3"><a class="reference internal" href="#undistort">undistort</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compute-depthmaps">compute_depthmaps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ground-control-points">Ground Control Points</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-file-format">JSON file format</a></li>
<li class="toctree-l3"><a class="reference internal" href="#txt-file-format">TXT file format</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html">Dataset Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataset.html#reconstruction-file-format">Reconstruction file format</a></li>
<li class="toctree-l1"><a class="reference internal" href="geometry.html">Geometric Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="cam_coord_system.html">Camera Coordinate System and Conventions</a></li>
<li class="toctree-l1"><a class="reference internal" href="reconstruction_module.html">Incremental reconstruction algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="large.html">Splitting a large dataset into smaller submodels</a></li>
<li class="toctree-l1"><a class="reference internal" href="reporting.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">Code Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="python3.html">Python 2 and 3 compatibility</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">OpenSfM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Using</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/mapillary/OpenSfM/blob/master/doc/source/using.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="using">
<h1>Using<a class="headerlink" href="#using" title="Permalink to this headline">¶</a></h1>
<div class="section" id="quickstart">
<h2>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h2>
<p>An example dataset is available at <code class="docutils literal notranslate"><span class="pre">data/berlin</span></code>.  You can reconstruct it using by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">opensfm_run_all</span> <span class="n">data</span><span class="o">/</span><span class="n">berlin</span>
</pre></div>
</div>
<p>This will run the entire SfM pipeline and produce the file <code class="docutils literal notranslate"><span class="pre">data/berlin/reconstruction.meshed.json</span></code> as output. To visualize the result you can start a HTTP server running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span>
</pre></div>
</div>
<p>and then browse <a class="reference external" href="http://localhost:8000/viewer/reconstruction.html#file=/data/berlin/reconstruction.meshed.json">http://localhost:8000/viewer/reconstruction.html#file=/data/berlin/reconstruction.meshed.json</a>
You should see something like</p>
<img alt="_images/berlin_viewer.jpg" src="_images/berlin_viewer.jpg" />
<p>You can click twice on an image to see it.  Then use arrows to move between images.</p>
<p>If you want to get a denser point cloud, you can run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bin</span><span class="o">/</span><span class="n">opensfm</span> <span class="n">undistort</span> <span class="n">data</span><span class="o">/</span><span class="n">berlin</span>
<span class="nb">bin</span><span class="o">/</span><span class="n">opensfm</span> <span class="n">compute_depthmaps</span> <span class="n">data</span><span class="o">/</span><span class="n">berlin</span>
</pre></div>
</div>
<p>This will run dense multiview stereo matching and produce a denser point cloud stored in <code class="docutils literal notranslate"><span class="pre">data/berlin/unidtorted/depthmaps/merged.ply</span></code>.  You can visualize that point cloud using <a class="reference external" href="http://www.meshlab.net/">MeshLab</a> or any other viewer that supports <a class="reference external" href="http://paulbourke.net/dataformats/ply/">PLY</a> files.</p>
<p>For the Berlin dataset you should get something similar to this</p>
<img alt="_images/berlin_point_cloud.jpg" src="_images/berlin_point_cloud.jpg" />
<p>To reconstruct your own images,</p>
<ol class="arabic simple">
<li>put some images in <code class="docutils literal notranslate"><span class="pre">data/DATASET_NAME/images/</span></code>, and</li>
<li>copy <code class="docutils literal notranslate"><span class="pre">data/berlin/config.yaml`</span> <span class="pre">to</span> <span class="pre">``data/DATASET_NAME/config.yaml</span></code></li>
</ol>
</div>
<div class="section" id="reconstruction-commands">
<h2>Reconstruction Commands<a class="headerlink" href="#reconstruction-commands" title="Permalink to this headline">¶</a></h2>
<p>There are several steps required to do a 3D reconstruction including feature detection, matching, SfM reconstruction and dense matching.  OpenSfM performs these steps using different commands that store the results into files for other commands to use.</p>
<p>The single application <code class="docutils literal notranslate"><span class="pre">bin/opensfm</span></code> is used to run those commands.  The first argument of the application is the command to run and the second one is the dataset to run the commands on.</p>
<p>Here is the usage page of <code class="docutils literal notranslate"><span class="pre">bin/opensfm</span></code>, which lists the available commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">usage</span><span class="p">:</span> <span class="n">opensfm</span> <span class="p">[</span><span class="o">-</span><span class="n">h</span><span class="p">]</span> <span class="n">command</span> <span class="o">...</span>

<span class="n">positional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="n">command</span>            <span class="n">Command</span> <span class="n">to</span> <span class="n">run</span>
    <span class="n">extract_metadata</span>
                     <span class="n">Extract</span> <span class="n">metadata</span> <span class="n">form</span> <span class="n">images</span><span class="s1">&#39; EXIF tag</span>
    <span class="n">detect_features</span>  <span class="n">Compute</span> <span class="n">features</span> <span class="k">for</span> <span class="nb">all</span> <span class="n">images</span>
    <span class="n">match_features</span>   <span class="n">Match</span> <span class="n">features</span> <span class="n">between</span> <span class="n">image</span> <span class="n">pairs</span>
    <span class="n">create_tracks</span>    <span class="n">Link</span> <span class="n">matches</span> <span class="n">pair</span><span class="o">-</span><span class="n">wise</span> <span class="n">matches</span> <span class="n">into</span> <span class="n">tracks</span>
    <span class="n">reconstruct</span>      <span class="n">Compute</span> <span class="n">the</span> <span class="n">reconstruction</span>
    <span class="n">mesh</span>             <span class="n">Add</span> <span class="n">delaunay</span> <span class="n">meshes</span> <span class="n">to</span> <span class="n">the</span> <span class="n">reconstruction</span>
    <span class="n">undistort</span>        <span class="n">Save</span> <span class="n">radially</span> <span class="n">undistorted</span> <span class="n">images</span>
    <span class="n">compute_depthmaps</span>
                     <span class="n">Compute</span> <span class="n">depthmap</span>
    <span class="n">export_ply</span>       <span class="n">Export</span> <span class="n">reconstruction</span> <span class="n">to</span> <span class="n">PLY</span> <span class="nb">format</span>
    <span class="n">export_openmvs</span>   <span class="n">Export</span> <span class="n">reconstruction</span> <span class="n">to</span> <span class="n">openMVS</span> <span class="nb">format</span>
    <span class="n">export_visualsfm</span>
                     <span class="n">Export</span> <span class="n">reconstruction</span> <span class="n">to</span> <span class="n">NVM_V3</span> <span class="nb">format</span> <span class="kn">from</span> <span class="nn">VisualSfM</span>

<span class="n">optional</span> <span class="n">arguments</span><span class="p">:</span>
  <span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="o">--</span><span class="n">help</span>         <span class="n">show</span> <span class="n">this</span> <span class="n">help</span> <span class="n">message</span> <span class="ow">and</span> <span class="n">exit</span>
</pre></div>
</div>
<div class="section" id="extract-metadata">
<h3>extract_metadata<a class="headerlink" href="#extract-metadata" title="Permalink to this headline">¶</a></h3>
<p>This commands extracts EXIF metadata from the images an stores them in the <code class="docutils literal notranslate"><span class="pre">exif</span></code> folder and the <code class="docutils literal notranslate"><span class="pre">camera_models.json</span></code> file.</p>
<p>The following data is extracted for each image:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">width</span></code> and <code class="docutils literal notranslate"><span class="pre">height</span></code>: image size in pixels</li>
<li><code class="docutils literal notranslate"><span class="pre">gps</span></code> <code class="docutils literal notranslate"><span class="pre">latitude</span></code>, <code class="docutils literal notranslate"><span class="pre">longitude</span></code>, <code class="docutils literal notranslate"><span class="pre">altitude</span></code> and <code class="docutils literal notranslate"><span class="pre">dop</span></code>: The GPS coordinates of the camera at capture time and the corresponding Dilution Of Precision).  This is used to geolocate the reconstruction.</li>
<li><code class="docutils literal notranslate"><span class="pre">capture_time</span></code>: The capture time. Used to choose candidate matching images when the option <code class="docutils literal notranslate"><span class="pre">matching_time_neighbors</span></code> is set.</li>
<li><code class="docutils literal notranslate"><span class="pre">camera</span> <span class="pre">orientation</span></code>: The EXIF orientation tag (see this <a class="reference external" href="http://sylvana.net/jpegcrop/exif_orientation.html">exif orientation documentation</a>).  Used to orient the reconstruction straight up.</li>
<li><code class="docutils literal notranslate"><span class="pre">projection_type</span></code>: The camera projection type.  It is extracted from the <a class="reference external" href="https://developers.google.com/streetview/spherical-metadata">GPano</a> metadata and used to determine which projection to use for each camera.  Supported types are <cite>perspective</cite>, <cite>equirectangular</cite> and <cite>fisheye</cite>.</li>
<li><code class="docutils literal notranslate"><span class="pre">focal_ratio</span></code>: The focal length provided by the EXIF metadata divided by the sensor width. This is used as initialization and prior for the camera focal length parameter.</li>
<li><code class="docutils literal notranslate"><span class="pre">make</span></code> and <code class="docutils literal notranslate"><span class="pre">model</span></code>: The camera make and model.  Used to build the camera ID.</li>
<li><code class="docutils literal notranslate"><span class="pre">camera</span></code>: The camera ID string. Used to identify a camera.  When multiple images have the same camera ID string, they will be assumed to be taken with the same camera and will share its parameters.</li>
</ul>
<p>Once the metadata for all images has been extracted, a list of camera models is created and stored in <code class="docutils literal notranslate"><span class="pre">camera_models.json</span></code>.  A camera model is created for each diferent camera ID string found on the images.</p>
<p>For each camera ID, the cammera model parameters are chosen using the following procedure.</p>
<ul class="simple">
<li>If the camera ID exists in the <code class="docutils literal notranslate"><span class="pre">camera_models_overrides.json</span></code> then the parameters are taken from that file.</li>
<li>Otherwise, if the camera ID exists in an internal calibration database, then the camera parameters are taken from the database.</li>
<li>Otherwise, the camera parameters are inferred from the avalable EXIF metadata.</li>
</ul>
<div class="section" id="providing-additional-metadata">
<h4>Providing additional metadata<a class="headerlink" href="#providing-additional-metadata" title="Permalink to this headline">¶</a></h4>
<p>When some metadata is missing or erroneous in the EXIF, it can be provided on the <code class="docutils literal notranslate"><span class="pre">exif_overrides.json</span></code> file.  This file must contain a dictionary mapping image names to the metadata fields that will override the values in the EXIF.</p>
<p>For example, to set the GPS location of an image that might not have it available in its EXIF tags, we will write the following in the <code class="docutils literal notranslate"><span class="pre">exif_overrides.json</span></code> file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;image_name.jpg&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;gps&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mf">52.51891</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mf">13.40029</span><span class="p">,</span>
            <span class="s2">&quot;altitude&quot;</span><span class="p">:</span> <span class="mf">27.0</span><span class="p">,</span>
            <span class="s2">&quot;dop&quot;</span><span class="p">:</span> <span class="mf">5.0</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These values are used during the <code class="docutils literal notranslate"><span class="pre">extract_metadata</span></code>, so we will need to rerun that command after writing the file.</p>
</div>
<div class="section" id="providing-your-own-camera-parameters">
<h4>Providing your own camera parameters<a class="headerlink" href="#providing-your-own-camera-parameters" title="Permalink to this headline">¶</a></h4>
<p>By default, the camera parameters are taken from the EXIF metadata using the procedure described above.  If you know the camera parameters that you want to use, you can put them in a file named <code class="docutils literal notranslate"><span class="pre">camera_models_overrides.json</span></code> in the project folder.  This file should have the same structure as <code class="docutils literal notranslate"><span class="pre">camera_models.json</span></code>.  That is a dictionary mapping camera identifiers to the desired camera parameters.</p>
<p>When running the <code class="docutils literal notranslate"><span class="pre">extract_metadata</span></code> command, the parameters of any camera present in the <code class="docutils literal notranslate"><span class="pre">camera_models_overrides.json</span></code> file will be copied to <code class="docutils literal notranslate"><span class="pre">camera_models.json</span></code> overriding the default ones.</p>
<p>The simplest way to create the <code class="docutils literal notranslate"><span class="pre">camera_models_overrides.json</span></code> file is to rename <code class="docutils literal notranslate"><span class="pre">camera_models.json</span></code> and modify the parameters.  You will need to rerun the <code class="docutils literal notranslate"><span class="pre">extract_metadata</span></code> command after that.</p>
<p>Optionally, you may want to override the camera parameters of <strong>all</strong> cameras in the dataset.  To do so, use <code class="docutils literal notranslate"><span class="pre">&quot;all&quot;</span></code> as camera ID.  For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;projection_type&quot;</span><span class="p">:</span> <span class="s2">&quot;perspective&quot;</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">,</span>
        <span class="s2">&quot;focal&quot;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>
        <span class="s2">&quot;k1&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;k2&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will set all cameras to use a perspective projection model.  Likewise:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;projection_type&quot;</span><span class="p">:</span> <span class="s2">&quot;fisheye&quot;</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">1920</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1080</span><span class="p">,</span>
        <span class="s2">&quot;focal&quot;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s2">&quot;k1&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="s2">&quot;k2&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will set all cameras to use a fisheye projection model.  And:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;projection_type&quot;</span><span class="p">:</span> <span class="s2">&quot;equirectangular&quot;</span><span class="p">,</span>
        <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="s2">&quot;height&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>will set all cameras to use an equirectangular panoramic projection model.</p>
<p>Have a look at the <a class="reference external" href="https://www.dropbox.com/sh/3vabbmrhqqbagp5/AABi14O2tWMbxAX91jaaQY77a?dl=0">spherical 360 images dataset</a> for a complete example using <code class="docutils literal notranslate"><span class="pre">camera_models_overrides.json</span></code> to specify that the camera is taking 360 equirectangular images.</p>
</div>
</div>
<div class="section" id="detect-features">
<h3>detect_features<a class="headerlink" href="#detect-features" title="Permalink to this headline">¶</a></h3>
<p>This command detects feature points in the images and stores them in the <cite>feature</cite> folder.</p>
</div>
<div class="section" id="match-features">
<h3>match_features<a class="headerlink" href="#match-features" title="Permalink to this headline">¶</a></h3>
<p>This command matches feature points between images and stores them in the <cite>matches</cite> folder.  It first determines the list of image pairs to run, and then run the matching process for each pair to find corresponding feature points.</p>
<p>Since there are a lot of possible image pairs, the process can be very slow.  It can be speeded up by restricting the list of pairs to match.  The pairs can be restricted by GPS distance, capture time or file name order.</p>
</div>
<div class="section" id="create-tracks">
<h3>create_tracks<a class="headerlink" href="#create-tracks" title="Permalink to this headline">¶</a></h3>
<p>This command links the matches between pairs of images to build feature point tracks.  The tracks are stored in the <cite>tracks.csv</cite> file.  A track is a set of feature points from different images that have been recognized to correspond to the same pysical point.</p>
</div>
<div class="section" id="reconstruct">
<h3>reconstruct<a class="headerlink" href="#reconstruct" title="Permalink to this headline">¶</a></h3>
<p>This command runs the incremental reconstruction process.  The goal of the reconstruction process is to find the 3D position of tracks (the <cite>structure</cite>) together with the position of the cameras (the <cite>motion</cite>).  The computed reconstruction is stored in the <code class="docutils literal notranslate"><span class="pre">reconstruction.json</span></code> file.</p>
</div>
<div class="section" id="mesh">
<h3>mesh<a class="headerlink" href="#mesh" title="Permalink to this headline">¶</a></h3>
<p>This process computes a rough triangular mesh of the scene seen by each images.  Such mesh is used for simulating smooth motions between images in the web viewer.  The reconstruction with the mesh added is stored in <code class="docutils literal notranslate"><span class="pre">reconstruction.meshed.json</span></code> file.</p>
<p>Note that the only difference between <code class="docutils literal notranslate"><span class="pre">reconstruction.json</span></code> and <code class="docutils literal notranslate"><span class="pre">reconstruction.meshed.json</span></code> is that the later contains the triangular meshes.  If you don’t need that, you only need the former file and there’s no need to run this command.</p>
</div>
<div class="section" id="undistort">
<h3>undistort<a class="headerlink" href="#undistort" title="Permalink to this headline">¶</a></h3>
<p>This command creates undistorted version of the reconstruction, tracks and images.  The undistorted version can later be used for computing depth maps.</p>
</div>
<div class="section" id="compute-depthmaps">
<h3>compute_depthmaps<a class="headerlink" href="#compute-depthmaps" title="Permalink to this headline">¶</a></h3>
<p>This commands computes a dense point cloud of the scene by computing and merging depthmaps.  It requires an undistorted reconstructions.  The resulting depthmaps are stored in the <code class="docutils literal notranslate"><span class="pre">depthmaps</span></code> folder and the merged point cloud is stored in <code class="docutils literal notranslate"><span class="pre">undistorted/depthmaps/merged.ply</span></code></p>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>SfM algorithms have options and depend on various parameters.  OpenSfM comes setup with default values for each option but you might want to tune some options for a particular dataset.  Options used to reconstruct a dataset can be set by editing the file <code class="docutils literal notranslate"><span class="pre">DATASET_PATH/config.yaml</span></code>.  Any option present in this file will override the default.</p>
<p>Checkout <a class="reference external" href="_modules/opensfm/config.html">the default configuration</a> to see the list of options.</p>
</div>
<div class="section" id="ground-control-points">
<h2>Ground Control Points<a class="headerlink" href="#ground-control-points" title="Permalink to this headline">¶</a></h2>
<p>When EXIF data contains GPS location, it is used by OpenSfM to georeference the reconstruction.  Additionally, it is possible to use ground control points.</p>
<p>Ground control points (GCP) are landmarks visible on the images for which the geospatial position (latitude, longitude and altitude) is known.  A single GCP can be observed in one or more images.</p>
<p>OpenSfM uses GCP in two steps of the reconstruction process: alignment and bundle adjustment.  In the alignment step, points are used to globaly move the reconstruction so that the observed GCP align with their GPS position.  Two or more observations for each GCP are required for it to be used during the aligment step.</p>
<p>In the bundle adjustment step, GCP observations are used as a constraint to refine the reconstruction.  In this step, all ground control points are used.  No minimum number of observation is required.</p>
<p>GPSs can be specified in two file formats.  If existing, both are loaded.</p>
<div class="section" id="json-file-format">
<h3>JSON file format<a class="headerlink" href="#json-file-format" title="Permalink to this headline">¶</a></h3>
<p>GCPs can be specified by adding a text file named <code class="docutils literal notranslate"><span class="pre">ground_control_points.json</span></code> at the root folder of the dataset. The format of the file should be as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;points&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">STRING</span><span class="p">,</span>
      <span class="s2">&quot;position&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="n">FLOAT</span><span class="p">,</span>
        <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="n">FLOAT</span><span class="p">,</span>
        <span class="s2">&quot;altitude&quot;</span><span class="p">:</span> <span class="n">FLOAT</span>  <span class="c1"># optional</span>
      <span class="p">},</span>
      <span class="s2">&quot;observations&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s2">&quot;shot_id&quot;</span><span class="p">:</span> <span class="n">STRING</span><span class="p">,</span>
          <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">FLOAT</span><span class="p">,</span> <span class="n">FLOAT</span><span class="p">]</span>  <span class="c1"># in normalized image coordinates</span>
        <span class="p">},</span>
        <span class="o">...</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="o">...</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For each point, the latitude and longitude in <a class="reference external" href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS84</a> are required.  The altitude, in meters, is optional.  For each image where the point has been observed, the image id and the coordinates of the observation in <a class="reference internal" href="geometry.html#normalized-image-coordinates"><span class="std std-ref">Normalized Image Coordinates</span></a> are required.</p>
</div>
<div class="section" id="txt-file-format">
<h3>TXT file format<a class="headerlink" href="#txt-file-format" title="Permalink to this headline">¶</a></h3>
<p>GCPs can be specified by adding a text file named <code class="docutils literal notranslate"><span class="pre">gcp_list.txt</span></code> at the root folder of the dataset. The format of the file should be as follows.</p>
<ul>
<li><p class="first">The first line should contain the name of the projection used for the geo coordinates.</p>
</li>
<li><p class="first">The following lines should contain the data for each ground control point observation. One per line and in the format:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">geo_x</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">geo_y</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">geo_z</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">im_x</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">im_y</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">image_name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">&lt;geo_x&gt;</span> <span class="pre">&lt;geo_y&gt;</span> <span class="pre">&lt;geo_z&gt;</span></code> are the geospatial coordinates of the GCP and <code class="docutils literal notranslate"><span class="pre">&lt;im_x&gt;</span> <span class="pre">&lt;im_y&gt;</span></code> are the <a class="reference internal" href="geometry.html#pixel-coordinates"><span class="std std-ref">Pixel Coordinates</span></a> where the GCP is observed.  If the altitude of the GCP is not known, set <code class="docutils literal notranslate"><span class="pre">&lt;geo_z&gt;</span></code> to <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.</p>
</li>
</ul>
<p><strong>Supported projections</strong></p>
<p>The geospatial coordinates can be specified in one the following formats.</p>
<ul class="simple">
<li><a class="reference external" href="https://en.wikipedia.org/wiki/World_Geodetic_System">WGS84</a>: This is the standard latitude, longitude coordinates used by most GPS devices. In this case, <code class="docutils literal notranslate"><span class="pre">&lt;geo_x&gt;</span> <span class="pre">=</span> <span class="pre">longitude</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;geo_y&gt;</span> <span class="pre">=</span> <span class="pre">latitude</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;geo_z&gt;</span> <span class="pre">=</span> <span class="pre">altitude</span></code></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system">UTM</a>: UTM projections can be specified using a string projection string such as <code class="docutils literal notranslate"><span class="pre">WGS84</span> <span class="pre">UTM</span> <span class="pre">32N</span></code>, where 32 is the region and N is . In this case, <code class="docutils literal notranslate"><span class="pre">&lt;geo_x&gt;</span> <span class="pre">=</span> <span class="pre">E</span></code>, <code class="docutils literal notranslate"><span class="pre">&lt;geo_y&gt;</span> <span class="pre">=</span> <span class="pre">N</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;geo_z&gt;</span> <span class="pre">=</span> <span class="pre">altitude</span></code></li>
<li><a class="reference external" href="http://proj4.org/">proj4</a>: Any valid proj4 format string can be used. For example, for UTM 32N we can use <code class="docutils literal notranslate"><span class="pre">+proj=utm</span> <span class="pre">+zone=32</span> <span class="pre">+north</span> <span class="pre">+ellps=WGS84</span> <span class="pre">+datum=WGS84</span> <span class="pre">+units=m</span> <span class="pre">+no_defs</span></code></li>
</ul>
<p><strong>Example</strong></p>
<p>This file defines 2 GCP whose coordinates are specified in the WGS84 standard. The first one is observed in both <code class="docutils literal notranslate"><span class="pre">01.jpg</span></code> and <code class="docutils literal notranslate"><span class="pre">02.jpg</span></code>, while the second one is only observed in <code class="docutils literal notranslate"><span class="pre">01.jpg</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WGS84</span>
<span class="mf">13.400740745</span> <span class="mf">52.519134104</span> <span class="mf">12.0792090446</span> <span class="mf">2335.0</span> <span class="mf">1416.7</span> <span class="mf">01.</span><span class="n">jpg</span>
<span class="mf">13.400740745</span> <span class="mf">52.519134104</span> <span class="mf">12.0792090446</span> <span class="mf">2639.1</span> <span class="mf">938.0</span> <span class="mf">02.</span><span class="n">jpg</span>
<span class="mf">13.400502446</span> <span class="mf">52.519251158</span> <span class="mf">16.7021233002</span> <span class="mf">766.0</span> <span class="mf">1133.1</span> <span class="mf">01.</span><span class="n">jpg</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dataset.html" class="btn btn-neutral float-right" title="Dataset Structure" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="building.html" class="btn btn-neutral float-left" title="Building" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Mapillary

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
 
<style>
  @import url('https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700&display=swap');
  html {
    font-family: 'Source Sans Pro', sans-serif;
  }
  .highlight {
    font-family: "Lucida Console", Monaco, monospace!important;
  }
  .wy-side-nav-search {
    background: #212b36;
  }
  .wy-side-nav-search input[type=text] {
    border-color: transparent;
    
  }
  .wy-nav-side {
    background: #212b36;
  }
  .wy-menu-vertical a:hover {
    color: #d9d9d9;
    background: rgba(255, 255, 255, 0.1);
  }
  a, a:hover {
    color: #05cb63;
  }
  body {
    color: #212b36;
  }
  .wy-nav-content-wrap {
    background: #fcfcfc!important;
  }
  .wy-side-nav-search>a:hover {
    color: #fff!important;
  }
  .highlight {
    background: #dee5ed;
  }
  .wy-menu-vertical li.on a, .wy-menu-vertical li.current>a {

  }
  .wy-menu-vertical li.toctree-l1.current>a {
    border-top: 0;
    border-bottom: 0;
  }
  .rst-content pre.literal-block, .rst-content div[class^='highlight'] {
    border-radius: 4px;
    border-color: #dee5ed!important;  
  }
</style>


</body>
</html>